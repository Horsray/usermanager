<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <title>绘影-登录</title>
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/flatly/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #0f2027, #203a43, #09394d); }
        .login-container { text-align: center; margin-bottom: 20px; }
        .login-card { border-radius: 1rem; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); backdrop-filter: blur(5px); display: flex; flex-direction: column; padding: 40px 30px; }
        .form-control { border-radius: 0.5rem; border: 1px solid rgba(0,0,0,0.1); transition: all 0.3s; }
        .form-control:focus { box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.25); border-color: #4facfe; }
        .btn-primary { background: linear-gradient(135deg, #4facfe 0%, #1097d6 100%); border: none; border-radius: 0.5rem; transition: transform 0.2s, box-shadow 0.2s; padding: 10px 0; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4); }
        .logo-container { display: flex; justify-content: center; margin-bottom: 20px; }
        .logo { width: 100px; height: 100px; object-fit: contain; border-radius: 50%; background: white; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .system-title {
  font-size: 2rem;
  font-weight: 700;
  color: #4e4949;
  margin-bottom: 12px;
  font-family: "隶书", "LiSu", "STLiti", serif;
}
        .space-switch { gap: 12px; }
        .space-switch .btn {
          border-radius: 6px;
          padding: 10px 16px;
          font-weight: 700;
          min-width: 140px;
          background: #fff;
          color: #333;
          border: 1px solid #ccc;
        }
        .space-switch .btn.active {
          background: linear-gradient(135deg, #4facfe 0%, #1097d6 100%);
          border: none;
          color: #fff;
        }
        .space-badge { font-size: 0.9rem; color: #2e2a2a; font-weight: 700; }
        .card-title { margin-bottom: 18px !important; }
    </style>
</head>
<body class="d-flex justify-content-center align-items-center vh-100 min-vh-100 flex-column">
  {% set space = request.args.get('space', session.get('space', 'huiying')) %}
  {% if space not in ['huiying','xiangyi'] %}{% set space = 'huiying' %}{% endif %}

  <div class="login-container">
    <div class="logo-container"><img src="/static/logo.png" alt="Logo" class="logo"></div>

    <!-- 空间切换按钮：只改变 URL 的 ?space= 值，不改后端逻辑 -->
    <div class="space-switch d-flex justify-content-center mb-2">
      <a class="btn btn-outline-primary {% if space=='huiying' %}active{% endif %}" href="/login?space=huiying">绘影</a>
      <a class="btn btn-outline-primary {% if space=='xiangyi' %}active{% endif %}" href="/login?space=xiangyi">相一</a>
    </div>
  </div>

  <div class="card login-card bg-white" style="min-width:320px; max-width:400px; width: 90%;">
    <h5 class="card-title text-center" style="font-size: 1.5rem; font-weight: 600;">销售管理系统（{{ '绘影' if space=='huiying' else '相一' }}）</h5>
    {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
    <form id="login-form" method="post" action="/login?space={{ space }}" data-space="{{ space }}">
      <!-- 把当前空间一并提交，后端会用它决定加载哪个 DB（不改原始逻辑） -->
      <input type="hidden" name="space" value="{{ space }}">
      <div class="mb-3">
        <label class="form-label">用户名</label>
        <input id="username" type="text" name="username" class="form-control" autocomplete="username" required>
      </div>
      <div class="mb-3">
        <label class="form-label">密码</label>
        <input id="password" type="password" name="password" class="form-control" autocomplete="current-password" required>
      </div>
      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" name="remember" id="remember" value="1">
        <label class="form-check-label" for="remember">记住密码</label>
      </div>
      <button type="submit" class="btn btn-primary w-100">登录</button>
    </form>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
(function(){
  var form = document.getElementById('login-form');
  if (!form) return;
  var space = form.getAttribute('data-space') || 'huiying';
  var usernameEl = document.getElementById('username');
  var passwordEl = document.getElementById('password');
  var rememberEl = document.getElementById('remember');
  var KEY = 'cred_' + space; // 每个空间单独保存

  // 读取本地保存的账号
  try {
    var raw = localStorage.getItem(KEY);
    if (raw) {
      var obj = JSON.parse(raw);
      if (!obj.expiresAt || Date.now() < obj.expiresAt) {
        if (obj.username && usernameEl) usernameEl.value = obj.username;
        if (obj.password && passwordEl) {
          passwordEl.value = obj.password;
          if (rememberEl) rememberEl.checked = true;
        }
      } else {
        localStorage.removeItem(KEY);
      }
    }
  } catch(e) {
    console.warn('localStorage parse failed', e);
  }

  // 提交前保存/清除
  form.addEventListener('submit', function(){
    try {
      if (rememberEl && rememberEl.checked) {
        var payload = {
          username: usernameEl ? usernameEl.value : '',
          password: passwordEl ? passwordEl.value : '',
          expiresAt: Date.now() + 7*24*3600*1000 // 7 天
        };
        localStorage.setItem(KEY, JSON.stringify(payload));
      } else {
        localStorage.removeItem(KEY);
      }
    } catch(e) {
      console.warn('localStorage write failed', e);
    }
  });
})();
</script>
</body>
</html>